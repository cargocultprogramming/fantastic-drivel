<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>rsync quick reference | karuken</title> <meta name="author" content=" cargocultprg"> <meta name="description" content="Frequent rsync commands and common confusion"> <meta name="keywords" content="jekyll, python, django"> <link rel="stylesheet" href="/assets/css/karuken.css?3bb37cbc33c05c8d466b8fc85560edfc"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%90%99&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://drivel.karuken.quest/blog/2023/rsync-recipes-and-faq/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container align-items-center"> <div class="karuken-header flex px-3"> <div>( .<sup>^</sup>. )</div> <div> ((( )))</div> </div> <a class="navbar-brand title font-weight-lighter" href="/">karuken</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/"></a> </li> <li class="nav-item active"> <a class="nav-link" href="/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/_pages/about/">about</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">rsync quick reference</h1> <p class="post-meta">December 2, 2023</p> <p class="post-tags"> <a href="/blog/2023"> <i class="fas fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/cli"> <i class="fas fa-hashtag fa-sm"></i> cli</a>   <a href="/blog/tag/linux"> <i class="fas fa-hashtag fa-sm"></i> linux</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p><code class="language-plaintext highlighter-rouge">rsync</code> is the go-to solution to quickly synchronize files between systems. It’s pretty versatile, but with that power also comes complexity in it’s usage. So let’s go over some common ones and clear up some confusion on the way.</p> <h2 id="common-rsync-options">common rsync options</h2> <p>TODO: important options</p> <dl> <dt><code class="language-plaintext highlighter-rouge">--dry-run, -n</code></dt> <dd>Dry run only simulates what would happen and is a good option to use if you are not sure or if an error would have bad consequences (such as when using <code class="language-plaintext highlighter-rouge">--delete</code>). Pipe the command through <code class="language-plaintext highlighter-rouge">grep del</code> to make sure to catch any delete actions.</dd> <dt><code class="language-plaintext highlighter-rouge">--archive, -a</code></dt> <dd>Archive mode, is a pretty common mode and a short cut of a bunch of other modes (<code class="language-plaintext highlighter-rouge">-rlptgoD</code>). It basically means preserve all file attributes (almost all) and do it recursively. It’s the basic go-to option for syncing directories.</dd> <dt><code class="language-plaintext highlighter-rouge">--delete</code></dt> <dd>Delete files the exist at destination but not at origin. Be careful with this one - if you mix up trailing slashes for example this will potentially delete a large number of files.</dd> <dt><code class="language-plaintext highlighter-rouge">--update, -u</code></dt> <dd>Ignores all files that exist on the destination and have a newer mtime than the file on the origin. In other words, this only updates older files on the destination. (If the mtime is equal, but size is different the destination will also be updated.)</dd> <dt><code class="language-plaintext highlighter-rouge">--ignore-existing</code></dt> <dd>Ignores all existing files, but will update the destination with any new files that exist at the origin. This does not ignore directories.</dd> <dt><code class="language-plaintext highlighter-rouge">--filter 'this'</code></dt> <dd>Filters out expressions that will not be synchronized from origin to destination. For example directories or files - also regular expressions are possible. For multiple strings just use the filter option repeatedly.</dd> </dl> <ul> <li><code class="language-plaintext highlighter-rouge">-avz</code></li> </ul> <h2 id="rsync-easy-ssh">rsync easy ssh</h2> <p><code class="language-plaintext highlighter-rouge">rsync</code> works over a number of protocols, most commonly ssh. With a little configuration this becomes very convenient. If you are using ssh public/private key pairs to log into your different boxes, you can easily set up shortcuts for these in <code class="language-plaintext highlighter-rouge">.ssh/config</code>. Here is an example:</p> <figure class="highlight"><pre><code class="language-config" data-lang="config"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td> <td class="code"><pre><span class="c">#.ssh/config
</span><span class="n">Host</span> <span class="n">blackbox</span>
        <span class="n">Hostname</span> <span class="m">68</span>.<span class="m">89</span>.<span class="m">147</span>.<span class="m">230</span>
        <span class="n">User</span> <span class="n">johnathan</span>.<span class="n">surname</span>

<span class="n">Host</span> <span class="n">pandora</span>
        <span class="n">Hostname</span> <span class="m">86</span>.<span class="m">98</span>.<span class="m">174</span>.<span class="m">305</span>
        <span class="n">User</span> <span class="n">john</span>

<span class="n">Host</span> <span class="n">pandora</span>-<span class="n">local</span>
        <span class="n">Hostname</span> <span class="m">192</span>.<span class="m">168</span>.<span class="m">0</span>.<span class="m">7</span>
        <span class="n">User</span> <span class="n">john</span>

<span class="n">Host</span> <span class="n">pandora</span>-<span class="n">local</span>-<span class="n">private</span>
        <span class="n">Hostname</span> <span class="m">192</span>.<span class="m">168</span>.<span class="m">0</span>.<span class="m">7</span>
        <span class="n">User</span> <span class="n">js</span>
</pre></td> </tr></tbody></table></code></pre></figure> <p>These lines basically set up shortcuts for the host/username-combination, so you don’t have to remember them yourself - just set and forget. With the keys, the login becomes effectively passwordless if the keys are available via ssh-agent for example (I’ll cover that in another post).</p> <p>The nifty thing in combination with <code class="language-plaintext highlighter-rouge">rsync</code> is, that once set up, this will enable path completion for your rsync command. So entering something like <code class="language-plaintext highlighter-rouge">rsync blackbox:~/</code> and hitting tab will automatically expand to <code class="language-plaintext highlighter-rouge">rsync blackbox:/home/jonathan.surname/</code>, add the first couple of letters of the directory you want to sync from, hit tab again and ssh will look up possible path completions in the the background. You can even hit tab twice after the slash and ssh will present you with a list of paths that are available, all without ever leaving the rsync line.</p> <h2 id="rsync-and-trailing-slashes">rsync and trailing slashes</h2> <p>A common confusion with <code class="language-plaintext highlighter-rouge">sync</code> is weather to use trailing slashes or not on the <em>source</em> directory (trailing slash presence doesnt matter for the destination directory).</p> <p>Here is a little mnemonic about this: if there is only the name of the directory itself <em>without</em> the slash, then the directory is the main thing, you name <strong>the_directory</strong>. But if you add a trailing slash, the directory that you named is not the main thing anymore - the slash adds a directional meaning <strong>from within</strong> the directory*.</p> <p><code class="language-plaintext highlighter-rouge">some_dir</code> (w/o trailing <code class="language-plaintext highlighter-rouge">/</code>): <strong>the_directory</strong></p> <p><code class="language-plaintext highlighter-rouge">some_dir/</code> (with trailing <code class="language-plaintext highlighter-rouge">/</code>): from <strong>within</strong> the directory</p> <p>So simply put: The slash adds direction.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h5 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h5> <p class="mb-2 small">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="small text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/quick-setup-django-pegasus/">Quick setup for django pegasus</a> </li> <li class="my-2"> <a class="small text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/webapp-setup-on-vps/">Configure a VPS for web apps</a> </li> <li class="my-2"> <a class="small text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/showing-directory-structure-tree/">Showing directory structure with tree</a> </li> <li class="my-2"> <a class="small text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/custom-login-message/">Custom shell login message</a> </li> <li class="my-2"> <a class="small text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/webhooks/">Easy-automate git deploys</a> </li> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0 py-0"> <div class="row small align-items-center"> <div class="col-12 col-md-3 container"> <span class="container" style="font-size:20px; vertical-align: middle;"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener" target="_blank">🅭🅯🄏🄎</a></span> 2023 cargocultprg </div> <div class="col-md-auto container d-none d-md-inline"> | </div> <div class="col container text-center"> <a href="https://drivel.karuken.quest/imprint">Imprint</a> </div> <div class="col-md-auto container d-none d-md-inline"> | </div> <div class="col-md-4 container d-none d-md-inline"> last update: December 31, 2023 </div> <div class="col container d-none d-md-inline"> </div> </div> </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>