<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Quick setup for django pegasus | karuken</title> <meta name="author" content=" cargocultprg"> <meta name="description" content="Notes for quickly setting up a django pegasus project"> <meta name="keywords" content="jekyll, python, django"> <link rel="stylesheet" href="/assets/css/karuken.css?3bb37cbc33c05c8d466b8fc85560edfc"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%90%99&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://drivel.karuken.quest/blog/2023/quick-setup-django-pegasus/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container align-items-center"> <div class="karuken-header flex px-3"> <div>( .<sup>^</sup>. )</div> <div> ((( )))</div> </div> <a class="navbar-brand title font-weight-lighter" href="/">karuken</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/"></a> </li> <li class="nav-item active"> <a class="nav-link" href="/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/_pages/about/">about</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="row"> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">Quick setup for django pegasus</h1> <p class="post-meta">December 10, 2023</p> <p class="post-tags"> <a href="/blog/2023"> <i class="fas fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/django"> <i class="fas fa-hashtag fa-sm"></i> django</a>   <a href="/blog/tag/python"> <i class="fas fa-hashtag fa-sm"></i> python</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p><a href="https://www.saaspegasus.com/projects/" rel="external nofollow noopener" target="_blank">SaaS Pegasus</a> is a configurable (commercial) template for django. There is good <a href="https://docs.saaspegasus.com/" rel="external nofollow noopener" target="_blank">official documentation</a> available from the software author.</p> <p>The author also provides great <a href="https://www.saaspegasus.com/guides/" rel="external nofollow noopener" target="_blank">guides on how the use django in a modern webstack</a> with a plethora of backend and frontend options from APIs over django core functionality to modern frontends like react, vue or htmx. I highly recommend to read through the guides if you want to better understand choices and tradeoffs in modern webstacks, in particular from a django perspective.</p> <p>SaaS Pegasus is a pretty good starting point for a django project that will come out of the box configured with many things you otherwise might have to set up manually. For example user management, different frontend options and backend options can be configured out of the box with reasonable choices and example code ready for use.</p> <p>However some finer points regarding configuration choices are a bit hidden in the docs and additionally I prefer to use a bit of a different setup in some details. So here are my notes for exactly that purpose.</p> <p>So these notes are most likely only useful for you, if you have bought access to SaaS Pegasus and want to, for example use <code class="language-plaintext highlighter-rouge">python poetry</code> to manage the environment instead of <code class="language-plaintext highlighter-rouge">venv</code> which is covered in the official docs.</p> <h2 id="initialization-from-pegasus">Initialization from pegasus</h2> <p>Starting a new pegasus project, is straight forward for the most part, just log into the web interface, give your project a name, pick some options, download it and you are good to go.</p> <p>Here I go into some consequences for the available options and explain alternatives (e.g. <code class="language-plaintext highlighter-rouge">poetry</code> instead of <code class="language-plaintext highlighter-rouge">venv</code>).</p> <h3 id="configuration-in-pegasus">Configuration in pegasus</h3> <p>There are a couple of setting that are not very obvious in their consequences:</p> <dl> <dt>Option <code class="language-plaintext highlighter-rouge">Example pages</code> </dt> <dd>Pulling in example pages results in a much larger code base. If you just want to inspect them, it’s better to look at them in a separate project.</dd> <dt>Option <code class="language-plaintext highlighter-rouge">Include static files</code> </dt> <dd>This pulls in static css and js files of the chosen frontend framework as opposed to pulling in only the sass files and generate the css on-the-fly. If changes to css via sass are planned, then it’s better to leave this unchecked and follow the instructions in the docs under <a href="https://docs.saaspegasus.com/front-end/" rel="external nofollow noopener" target="_blank">https://docs.saaspegasus.com/front-end/</a>. This will require setting up npm and running the webpack compiler whenever the css changes. The same goes for <code class="language-plaintext highlighter-rouge">webpack</code>: if the static files are included there is no webpack setup, for example if you want to include your own javascript.</dd> </dl> <h3 id="git--github">git / github</h3> <p>Configure and download project, unpack and run:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git init
git add <span class="nb">.</span>
git commit <span class="nt">-am</span> <span class="s2">"initial project creation"</span>
git branch pegasus  <span class="c"># for easy merging of future updates</span>
git branch <span class="nt">-M</span> main
<span class="c"># head over to github (or whereever) and create repo</span>
git remote add origin https://&lt;created-github-repo&gt;
</code></pre></div></div> <p>In case remote and local default branches have different names, you can rename the local branch <code class="language-plaintext highlighter-rouge">git branch -m master main</code>. If pushing to main doesn’t recognize the branch right away it’s possible to set it explicitly using <code class="language-plaintext highlighter-rouge">git branch --set-upstream-to=origin/main main</code>. ‘’’ Then sync both branches, main and pegasus.</p> <p>It’s best to create the repo empty on the github side, otherwise there is some need to merge e.g. gitignore files.</p> <h3 id="python-env-using-poetry">python env using poetry</h3> <p><code class="language-plaintext highlighter-rouge">poetry</code> is not officially supported but can be used via the <code class="language-plaintext highlighter-rouge">requirement.ini</code> files.</p> <p>First initialize poetry by running <code class="language-plaintext highlighter-rouge">poetry init</code>, make sure to select the proper python version and dont specifiy any dependencies during initialization. The new poetry configuration will be appended to the existing <code class="language-plaintext highlighter-rouge">pyproject.toml</code>.</p> <p>The python versions for pegasus versions are:</p> <ul> <li>pegasus-2023.11.1 (since 2023.4): python-3.11</li> </ul> <p>To create the virtual env <em>inside</em> the project directory in <code class="language-plaintext highlighter-rouge">.venv</code>, check that the option <code class="language-plaintext highlighter-rouge">virtualenvs.in-project</code> is set to <code class="language-plaintext highlighter-rouge">true</code>:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>poetry config <span class="nt">--list</span>  <span class="c"># check config settings</span>
poetry virtualenvs.in-project <span class="nb">true</span>  <span class="c"># set explicitly</span>
</code></pre></div></div> <p>Then add the required packages via poetry as described below.</p> <p><code class="language-plaintext highlighter-rouge">requirement.txt</code> contains fixed versions of <em>all</em> packages of the resolved dependency tree, similar to what is recorded in <code class="language-plaintext highlighter-rouge">poetry.lock</code>.</p> <p>We could run <code class="language-plaintext highlighter-rouge">poetry add</code> with the fully-resolved list of packages and their version constraints in the <code class="language-plaintext highlighter-rouge">requirements/*requirements.txt</code> files, but it’s more generic to add the actual requirements from the <code class="language-plaintext highlighter-rouge">requirements/*requirements.in</code> files.</p> <p>So if we want to use the minimal, generic dependencies, we just run <code class="language-plaintext highlighter-rouge">poetry add</code> for each line of the <code class="language-plaintext highlighter-rouge">.in</code> files. Note that this will not result in the exact same package versions as in the <code class="language-plaintext highlighter-rouge">requirements.txt</code> files, since poetry will run the resolver and pull the latest available packages fitting the constraints. This may or may not work with the code base (but often will).</p> <p>To run <code class="language-plaintext highlighter-rouge">poetry add</code> on each line use the following commands. <code class="language-plaintext highlighter-rouge">grep</code> excludes links to constraints and <code class="language-plaintext highlighter-rouge">sed</code> drops comments.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat </span>requirements/dev-requirements.in | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s1">'\-c '</span>| <span class="nb">sed</span> <span class="s1">'s/\s#.*//'</span> | xargs poetry add <span class="nt">--group</span> dev
</code></pre></div></div> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat </span>requirements/requirements.in | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s1">'\-c '</span> | <span class="nb">sed</span> <span class="s1">'s/\s#.*//'</span> | xargs poetry add
</code></pre></div></div> <p>Lastly, to select the correct virtual environment in visual studio code, select <code class="language-plaintext highlighter-rouge">Python: Select Interpreter</code> from the command palette (Shift-Ctrl-P) and pick <code class="language-plaintext highlighter-rouge">./.venv</code> from the list.</p> <h3 id="setting-up-a-webpack-workflow">Setting up a <code class="language-plaintext highlighter-rouge">webpack</code> workflow</h3> <p>The reasoning and tradeoffs on how to integrate js (and frontend libraries) are covered in the guide about <a href="https://www.saaspegasus.com/guides/" rel="external nofollow noopener" target="_blank">Modern JavaScript for Django Developers</a>.</p> <p>Remember, to take this approach, do <strong>not</strong> select the option <code class="language-plaintext highlighter-rouge">Include static files</code> in the project configuration.</p> <p>The details of the setup for SaaS Pegasus are covered in two parts of the documentation:</p> <ol> <li>For javascript in the section <a href="https://docs.saaspegasus.com/front-end/" rel="external nofollow noopener" target="_blank">The Front End</a> </li> <li>For css in the section <a href="https://docs.saaspegasus.com/css/" rel="external nofollow noopener" target="_blank">CSS</a> </li> </ol> <p>If the <code class="language-plaintext highlighter-rouge">Include static files</code> option was not in the project configuration, the project package comes complete with a <code class="language-plaintext highlighter-rouge">webpack-config.js</code> file configured for the chosen css frontend (e.g. bootstrap).</p> <p>The next step is to set up a javascript environment for the project. That works similar to setting up a python environment.</p> <p>The <a href="https://docs.saaspegasus.com/front-end/#prerequisites-to-building-the-front-end" rel="external nofollow noopener" target="_blank">pegasus docs</a> mention <code class="language-plaintext highlighter-rouge">nvm</code>, the <code class="language-plaintext highlighter-rouge">npm</code> version manager (similar to <code class="language-plaintext highlighter-rouge">virtualenv</code>) but don’t go into details.</p> <p><code class="language-plaintext highlighter-rouge">nvm</code> installation is described in detail on <a href="https://github.com/nvm-sh/nvm" rel="external nofollow noopener" target="_blank">this github webseite</a> - the gist is to install <code class="language-plaintext highlighter-rouge">nvm</code> on the user level and switch <code class="language-plaintext highlighter-rouge">npm</code> versions on the go, depending on the directory one works in. To this end, the <code class="language-plaintext highlighter-rouge">nvm</code> installer script appends some lines to the <code class="language-plaintext highlighter-rouge">.bashrc</code> file.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/
curl <span class="nt">-o-</span> https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
<span class="nb">source</span> .bashrc
</code></pre></div></div> <p>After installation of <code class="language-plaintext highlighter-rouge">nvm</code> any instructions recommending running <code class="language-plaintext highlighter-rouge">npm</code> as root should instead be run as user.</p> <p>How to use <code class="language-plaintext highlighter-rouge">nvm</code> is covered in the <a href="https://github.com/nvm-sh/nvm#usage" rel="external nofollow noopener" target="_blank">Usage section of the official docs</a>, but basically you can then install the latest version of node:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nvm <span class="nb">install </span>node
which nvm  <span class="c"># will point to ~/.nvm/versions/...</span>
</code></pre></div></div> <p>Once this is done, change into the project directory and run</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install</span>
</code></pre></div></div> <p>This will read the included <code class="language-plaintext highlighter-rouge">package.json</code> file and install the javascript packages configured there.</p> <p>Then you can proceed to build the javascript (and css) bundles using webpack via the preconfigure command <code class="language-plaintext highlighter-rouge">npm run dev</code> or <code class="language-plaintext highlighter-rouge">npm run dev-watch</code>. To build for production, run <code class="language-plaintext highlighter-rouge">npm run build</code>.</p> <p>To configure the webpack build system look at the section <a href="https://docs.saaspegasus.com/front-end/#long-term-best-practices" rel="external nofollow noopener" target="_blank">Long-term best practicse</a> of the pegasus front-end docs. This includes instructions on how the set up own javascript code, compile per-page etc.</p> <p>In particular, the <code class="language-plaintext highlighter-rouge">webpack.config.js</code> file contains definitions for various <code class="language-plaintext highlighter-rouge">entry</code> (= source files) and <code class="language-plaintext highlighter-rouge">output</code> (= destination files). For example to add a special script <code class="language-plaintext highlighter-rouge">special.js</code> add the script to the <code class="language-plaintext highlighter-rouge">entry</code> part like this:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">entry</span><span class="p">:</span> <span class="p">{</span>
    <span class="c1">// more entries</span>
    <span class="dl">'</span><span class="s1">special</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./assets/javascript/special.js</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">assets/javascript/special.js</code> will then be compiled into <code class="language-plaintext highlighter-rouge">static/js/special-bundle.js</code></p> <p>The convention for the location of <code class="language-plaintext highlighter-rouge">entry</code> and <code class="language-plaintext highlighter-rouge">output</code> directories is to have the former in the <code class="language-plaintext highlighter-rouge">assets/javascript/</code> folder and the latter in the <code class="language-plaintext highlighter-rouge">static</code> folder.</p> <p>The output js files need to be loaded on the respective html pages:</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
{% load static %}
{% block page_js %}
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"{% static 'js/app-bundle.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"{% static 'js/special-bundle.js' %}"</span><span class="nt">&gt;&lt;/script&gt;</span>
{% endblock page_js %}

</code></pre></div></div> <h3 id="passing-data-from-django-to-javascript">Passing data from django to javascript</h3> <p>This can be done either directly via django templates or via api calls. The first option is great for small amounts of data that is directly available in a django model, the second option is better for larger data sets (e.g. graphs) that can be fetched asynchronously from an api.</p> <p>Her is <a href="https://www.saaspegasus.com/guides/modern-javascript-for-django-developers/integrating-django-react/#passing-data-directly-with-djangos-template-system" rel="external nofollow noopener" target="_blank">documentation on how to pass data to javascript via django templates</a>. Basically you build a dict in django and render it in the template using the <code class="language-plaintext highlighter-rouge">json_script</code> template tag.</p> <p>The simplest way to pass single variable <code class="language-plaintext highlighter-rouge">mystringvar</code> is, to just render it directly in the template like this:</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nt">&lt;script </span><span class="na">id=</span><span class="s">"mystringvar"</span> <span class="na">type=</span><span class="s">"application/json"</span><span class="nt">&gt;</span><span class="dl">"</span><span class="s2">{{ simulation.mystringvar }}</span><span class="dl">"</span><span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"{% static 'rheo_three-bundle.js' %}"</span>

</code></pre></div></div> <p>The variable can then be retrieved in the javascript by</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mystringvar</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">mystringvar</span><span class="dl">'</span><span class="p">).</span><span class="nx">textContent</span><span class="p">;</span>
<span class="c1">// for more complex json dicts:</span>
<span class="c1">//const mystringvar = JSON.parse(document.getElementById('mystringvar').textContent)</span>
</code></pre></div></div> <p>To include all this via webpack in an external script file and log <code class="language-plaintext highlighter-rouge">mystringvar</code> to the console as well as display it on the page as content of a div with the <code class="language-plaintext highlighter-rouge">id="mystringvar-div"</code> you can do the following:</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// assets/javascript/special.js</span>
<span class="kd">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// this is populated from django and rendered into the django template - we retrieve it here in js</span>
    <span class="kd">const</span> <span class="nx">mystringvar</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">mystringvar</span><span class="dl">'</span><span class="p">).</span><span class="nx">textContent</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">mystringvar</span><span class="p">);</span>
<span class="p">}</span>
<span class="nf">foo</span><span class="p">();</span>  <span class="c1">// will print mystringvar to the javascript console</span>

<span class="c1">// will show mystringvar as inner text content of &lt;div id="mystringvar-div"&gt;&lt;/div&gt;</span>
<span class="kd">const</span> <span class="nx">mystringvar</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">mystringvar</span><span class="dl">'</span><span class="p">).</span><span class="nx">textContent</span><span class="p">;</span>
<span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">mystringvar-div</span><span class="dl">'</span><span class="p">).</span><span class="nx">innerText</span> <span class="o">=</span> <span class="nx">mystringvar</span>
</code></pre></div></div> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"mystringvar-div"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;script </span><span class="na">id=</span><span class="s">"mystringvar"</span> <span class="na">type=</span><span class="s">"application/json"</span><span class="nt">&gt;</span><span class="dl">"</span><span class="s2">{{ simulation.mystringvar }}</span><span class="dl">"</span><span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"{% static 'rheo_three-bundle.js' %}"</span>

</code></pre></div></div> <h3 id="customizing-the-theme">Customizing the theme</h3> <p>I’m exclusively using bootstrap 5 here since it is the most prevalent framework out there.</p> <p>Pegasus uses sass via <code class="language-plaintext highlighter-rouge">webpack</code> (see previous chapter) and additionally splits the sass files into two parts:</p> <ul> <li>css-framework independent styles: <code class="language-plaintext highlighter-rouge">/assets/styles/app/base.sass</code> –&gt; <code class="language-plaintext highlighter-rouge">static/site-base.css</code> </li> <li>css-framework overrides: <code class="language-plaintext highlighter-rouge">/assets/styles/app/bootstrap/</code> –&gt; <code class="language-plaintext highlighter-rouge">static/site-bootstrap.css</code> </li> </ul> <p>To override bootstrap styles, edit <code class="language-plaintext highlighter-rouge">assets/styles/site-bootstrap.scss</code> according to the bootstrap docs. Edits will only apply if you run <code class="language-plaintext highlighter-rouge">npm run dev</code> (<code class="language-plaintext highlighter-rouge">dev-watch</code>).</p> <p>If you change any bootstrap scss variables, you need to do so before the boostrap css files are included or they will have no effect. Bootstrap class overrides go into the file after bootsrap code is included.</p> <h3 id="user-setup">User setup</h3> <p>Start a first user by starting the server <code class="language-plaintext highlighter-rouge">django runserver</code> (see below how to set up the <code class="language-plaintext highlighter-rouge">django</code>-shortcut) and going through the registration process. Then elevate the user to superuser with the script supplied by pegasus: <code class="language-plaintext highlighter-rouge">django promote_user_to_superuser yourname@example.com</code>. After that, you can log in and access <code class="language-plaintext highlighter-rouge">http://localhost:8000/admin</code>.</p> <h2 id="add-a-custom-app">Add a custom app</h2> <p>Pegasus organizes all apps in the <code class="language-plaintext highlighter-rouge">apps</code> directory. To add an app there specify a path when calling startapp:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>apps/projects
django startapp projects apps/projects
</code></pre></div></div> <p>The broad next steps are then:</p> <ul> <li>Add a model</li> <li>Create a view for the model</li> <li>Create a <code class="language-plaintext highlighter-rouge">urls.py</code> file and add the url scheme</li> <li>Include the new <code class="language-plaintext highlighter-rouge">apps/projects/urls.py</code> in the <em>project</em> <code class="language-plaintext highlighter-rouge">urls.py</code> </li> <li>Add a template in <code class="language-plaintext highlighter-rouge">templates/web/...</code> </li> <li>Create an object via the admin interface</li> <li>Start migrations and test</li> </ul> <p>Lets go over the code in detail quickly. This uses generic class based views.</p> <h3 id="create-a-model">Create a model</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># apps/project/models.py
</span><span class="kn">from</span> <span class="n">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="c1"># Create your models here.
</span>
<span class="c1"># basic project model
</span><span class="k">class</span> <span class="nc">Project</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="nc">CharField</span><span class="p">(</span>
        <span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
        <span class="n">help_text</span><span class="o">=</span><span class="sh">"</span><span class="s">Descriptive project name.</span><span class="sh">"</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">models</span><span class="p">.</span><span class="nc">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">name</span><span class="si">}</span><span class="s"> (created: </span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">created</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span>
</code></pre></div></div> <h3 id="create-a-view-for-the-model">Create a view for the model</h3> <p>We just implement the DetailView here:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># apps/project/views.py
</span><span class="kn">from</span> <span class="n">django.views.generic</span> <span class="kn">import</span> <span class="n">DetailView</span>
<span class="kn">from</span> <span class="n">.models</span> <span class="kn">import</span> <span class="n">Project</span>

<span class="c1"># Create your views here.
</span>
<span class="k">class</span> <span class="nc">ProjectDetailView</span><span class="p">(</span><span class="n">DetailView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Project</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">web/project.html</span><span class="sh">"</span>
</code></pre></div></div> <h3 id="create-and-link-urls">Create and link urls</h3> <p>Create <code class="language-plaintext highlighter-rouge">urls.py</code>:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># apps/project/urls.py
</span><span class="kn">from</span> <span class="n">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="n">.views</span> <span class="kn">import</span> <span class="n">ProjectDetailView</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nf">path</span><span class="p">(</span><span class="sh">"</span><span class="s">project/&lt;int:pk&gt;</span><span class="sh">"</span><span class="p">,</span> <span class="n">ProjectDetailView</span><span class="p">.</span><span class="nf">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">project</span><span class="sh">"</span><span class="p">),</span>
<span class="p">]</span>
</code></pre></div></div> <p>Now include this new <code class="language-plaintext highlighter-rouge">urls.py</code> in the <em>project</em> file in <code class="language-plaintext highlighter-rouge">project_name/project_name/urls.py</code> at the end of the <code class="language-plaintext highlighter-rouge">urlpatterns</code>:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># redirect Django admin login to main login page
</span>    <span class="c1"># ... path includes ..
</span>    <span class="c1"># myproject projects
</span>    <span class="nf">path</span><span class="p">(</span><span class="sh">""</span><span class="p">,</span> <span class="nf">include</span><span class="p">(</span><span class="sh">"</span><span class="s">apps.projects.urls</span><span class="sh">"</span><span class="p">))</span>
<span class="p">]</span> <span class="o">+</span> <span class="nf">static</span><span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">MEDIA_URL</span><span class="p">,</span> <span class="n">document_root</span><span class="o">=</span><span class="n">settings</span><span class="p">.</span><span class="n">MEDIA_ROOT</span><span class="p">)</span>
</code></pre></div></div> <h3 id="add-a-template">Add a template</h3> <p>Pegasus keeps templates in a global <code class="language-plaintext highlighter-rouge">template</code> directory. It’s possible to either create a subdirectory there for the app, or if there are no namespace clashes, I can add the template directly in the existing structure. In this case I will just use a single Detail view, so I put the template in <code class="language-plaintext highlighter-rouge">templates/web/project.html</code>. To make things easier to maintain I break this down into sections:</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c">&lt;!-- templates/web/project.html --&gt;</span>
{% extends "web/base.html" %}
{% load static %}
{% block body %}
  {% include 'web/components/projects_detail.html' %}
{% endblock %}

</code></pre></div></div> <p>Then in <code class="language-plaintext highlighter-rouge">projects_detail.html</code> I can show the details:</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c">&lt;!-- templates/web/components/projects_detail.html --&gt;</span>
{% load i18n %}
{% load static %}
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container text-center"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row justify-content-center"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col col-md-8 align-self-center"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row align-items-center justify-content-center py-4 border-dark border-top border-bottom border-opacity-25"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col"</span><span class="nt">&gt;</span>
          Project: <span class="nt">&lt;h1&gt;</span>{{ project.name }}<span class="nt">&lt;/h1&gt;</span>
          <span class="nt">&lt;p&gt;</span>Project creation time: {{ project.created}} <span class="nt">&lt;/p&gt;</span>
          <span class="nt">&lt;p&gt;</span>Project primary key: {{ project.pk }} <span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>

</code></pre></div></div> <h3 id="migrations-and-test">Migrations and test</h3> <p>Run <code class="language-plaintext highlighter-rouge">django makemigrations &amp;&amp; django migrate</code>, start the server <code class="language-plaintext highlighter-rouge">django runserver</code>. Then add a object instance from <code class="language-plaintext highlighter-rouge">127.0.0.1:8000/admin</code> and check the view according to the url-scheme under <code class="language-plaintext highlighter-rouge">127.0.0.1:8000/projects/1</code>.</p> <h2 id="misc-hints">Misc. hints</h2> <h3 id="django-shortcut-command">‘django’ shortcut command</h3> <p>Instead of running <code class="language-plaintext highlighter-rouge">python manage.py ...</code> all the time we can abbreviate this to a <code class="language-plaintext highlighter-rouge">django</code> command by appending the following to our <code class="language-plaintext highlighter-rouge">.bashrc</code>:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># wrapper command for django's "python manage.py"</span>
django<span class="o">(){</span>
        python manage.py <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
<span class="o">}</span>
</code></pre></div></div> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h5 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h5> <p class="mb-2 small">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="small text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/webapp-setup-on-vps/">Configure a VPS for web apps</a> </li> <li class="my-2"> <a class="small text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/rsync-recipes-and-faq/">rsync quick reference</a> </li> <li class="my-2"> <a class="small text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/bootstrap-icons/">Use boostrap icons on a website</a> </li> <li class="my-2"> <a class="small text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/custom-login-message/">Custom shell login message</a> </li> <li class="my-2"> <a class="small text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/creative-commons-font-icons/">Creative commons font icons</a> </li> </div> </div> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0 py-0"> <div class="row small align-items-center"> <div class="col-12 col-md-3 container"> <span class="container" style="font-size:20px; vertical-align: middle;"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener" target="_blank">🅭🅯🄏🄎</a></span> 2023 cargocultprg </div> <div class="col-md-auto container d-none d-md-inline"> | </div> <div class="col container text-center"> <a href="https://drivel.karuken.quest/imprint">Imprint</a> </div> <div class="col-md-auto container d-none d-md-inline"> | </div> <div class="col-md-4 container d-none d-md-inline"> last update: December 31, 2023 </div> <div class="col container d-none d-md-inline"> </div> </div> </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>